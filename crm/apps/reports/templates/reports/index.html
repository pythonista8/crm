{% extends 'onekloud/base.html' %}
{% load static humanize %}

{% block css %}
<link rel="stylesheet" href="{% static 'reports/onekloud/css/reports.css' %}">
{% endblock %}

{% block head %}
<!--[if lte IE 8]>
    <script src="{% static 'reports/onekloud/js/excanvas.js' %}"></script>
<![endif]-->
{% endblock %}

{% block content %}
<div id="report-tabs">
    <div class="pure-g-r">
        <div class="pure-u-1">
            <h3>Monthly Sales Trend</h3>
            <div class="pure-g-r">
                <div class="pure-u-4-5">
                    <div class="l-box">
                        <canvas id="chart-trend" width="780" height="250"></canvas>
                    </div>
                </div>
                <div class="pure-u-1-5">
                    <div class="l-box">
                        <div class="chart-details">
                            <span class="chart-color" style="background: rgb(151,187,205)"></span>
                            <small>Closed-Win</small>
                        </div>
                        <div class="chart-details">
                            <span class="chart-color" style="background: rgb(220,220,220)"></span>
                            <small>Closed-Lost</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="pure-u-1-2">
            <h3>Total Number of Cases</h3>
            <div class="pure-g-r">
                <div class="pure-u-1-2 chart-box">
                    <div class="l-box">
                        <canvas id="chart-number" width="200" height="200"
                                {% if not data_number %} style="display: none"{% endif %}></canvas>
                        {% if not data_number %}
                            <span class="gray">There is no data yet.</span>
                        {% endif %}
                    </div>
                </div>
                <div class="pure-u-1-2">
                    <div class="l-box">
                        {% for dict in data_number %}
                            <div class="chart-details">
                                <span class="chart-color" style="background: {{ dict.color }}"></span>
                                <small>{{ dict.label }} ( <b>{{ dict.value|intcomma }}</b> )</small>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="pure-u-1-2">
            <h3>Total Income</h3>
            <div class="pure-g-r">
                <div class="pure-u-1-2 chart-box">
                    <div class="l-box">
                        <canvas id="chart-amount" width="200" height="200"
                                {% if not data_amount %} style="display: none"{% endif %}></canvas>
                        {% if not data_amount %}
                            <span class="gray">There is no data yet.</span>
                        {% endif %}
                    </div>
                </div>
                <div class="pure-u-1-2">
                    <div class="l-box">
                        {% for dict in data_amount %}
                            <div class="chart-details">
                                <span class="chart-color" style="background: {{ dict.color }}"></span>
                                <small>{{ dict.label }} ( <b>{{ dict.value|intcomma }}</b> )</small>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="{% static 'reports/vendor/chartjs/js/Chart.js' %}"></script>
<script>

// Monthly Sales Trend.
var monthLabels = [];

{% for month in long_month_names %}
  monthLabels.push('{{ month }}');
{% endfor %}

var dataTrendWin = [];
var dataTrendLost = [];

{% for amount in monthly_win_trend %}
  dataTrendWin.push({{ amount }});
{% endfor %}

{% for amount in monthly_lost_trend %}
  dataTrendLost.push({{ amount }});
{% endfor %}

var dataTrend = {
  labels: monthLabels,
  datasets: [
    {
      fillColor: "rgba(220,220,220,.5)",
      strokeColor: "rgba(220,220,220,1)",
      pointColor: "rgba(220,220,220,1)",
      pointStrokeColor: "#fff",
      data: dataTrendLost
    },
    {
      fillColor: "rgba(151,187,205,.5)",
      strokeColor: "rgba(151,187,205,1)",
      pointColor: "rgba(151,187,205,1)",
      pointStrokeColor: "#fff",
      data: dataTrendWin
    }
  ]
};

// Total Number of Cases.
var dataNumber = [];

{% for dict in data_number %}
  dataNumber.push({
    value: {{ dict.value }},
    color: '{{ dict.color }}'
  });
{% endfor %}

// Total Amount.
var dataAmount = [];

{% for dict in data_amount %}
  dataAmount.push({
    value: {{ dict.value }},
    color: '{{ dict.color }}'
  });
{% endfor %}

</script>
<script src="{% static 'reports/onekloud/js/load.js' %}"></script>
{% endblock %}

{% block menu-reports %}
pure-menu-selected
{% endblock %}
